#!/usr/bin/env ruby
# frozen_string_literal: true

# Dotfiles installer (Ruby)

def run!(*cmd)
  cmd = cmd.flatten
  puts "â–¶ #{cmd.join(' ')}"
  system(*cmd)
  status = $?.exitstatus
  if status != 0
    warn "âœ– Failed (exit #{status}): #{cmd.join(' ')}"
    exit(status || 1)
  end
end

puts "âœ¨ [Dotfiles] Start"

home = ENV["HOME"].to_s
dotfiles_dir = File.expand_path(File.join(home, "supplement/dotfiles"))
Dir.chdir(dotfiles_dir)

# æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã£ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ã›ãšã€ãƒªãƒ³ã‚¯ã«ç½®ãæ›ãˆã‚‹
%w[zsh p10k ideavim].each do |pkg|
  run! "stow", "-v", "-R", "--adopt", "--no-folding", "-t", home, pkg
end

puts "ğŸ‰ [Dotfiles] Completed"